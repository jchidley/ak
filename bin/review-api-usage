#!/bin/bash
# Monthly API Usage Review Script
# See: ~/API_KEY_SECURITY_PLAN.md

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  Monthly API Usage Review - $(date +%Y-%m-%d)"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“Š Check the following dashboards for unusual activity:"
echo ""
echo "HIGH RISK (unbounded spend):"
echo "  Anthropic:  https://console.anthropic.com/settings/usage"
echo "  OpenAI:     https://platform.openai.com/usage"
echo "  Google AI:  https://console.cloud.google.com/apis/dashboard"
echo "  DeepSeek:   https://platform.deepseek.com/usage"
echo ""
echo "CRITICAL (code access):"
echo "  GitHub:     https://github.com/settings/tokens"
echo "              (check 'Last used' column for each token)"
echo ""
echo "MEDIUM RISK:"
echo "  Groq:       https://console.groq.com/usage"
echo "  Moonshot:   https://platform.moonshot.ai/usage"
echo ""
echo "LOW RISK:"
echo "  Brave:      (rate-limited, free tier)"
echo "  Spider:     (quota-limited)"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âš ï¸  Look for:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  â€¢ Unexpected spikes in usage"
echo "  â€¢ Usage from unknown IPs/locations"
echo "  â€¢ Patterns suggesting automation/abuse"
echo "  â€¢ Charges exceeding spending limits"
echo "  â€¢ Tokens that haven't been used in 90+ days (can be deleted)"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸš¨ If anything looks suspicious:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  1. Revoke the key immediately at the provider"
echo "  2. Create a new key with a different name"
echo "  3. Update the key in Bitwarden"
echo "  4. Run: bw_unlock"
echo "  5. Test with: load-<service> && <test-command>"
echo "  6. Document the incident in API_KEY_SECURITY_PLAN.md"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ“… Rotation Schedule:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  Monthly (High Priority):"
echo "    â€¢ Anthropic (limited)"
echo "    â€¢ OpenAI (limited)"
echo "    â€¢ DeepSeek (limited)"
echo "    â€¢ Moonshot (limited)"
echo ""
echo "  Quarterly:"
echo "    â€¢ Google AI"
echo "    â€¢ Groq"
echo ""
echo "  Every 85 days:"
echo "    â€¢ GitHub fine-grained tokens (before 90-day expiry)"
echo ""
echo "  Annually:"
echo "    â€¢ Brave"
echo "    â€¢ Spider"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "Next scheduled review: $(date -d '+1 month' +%Y-%m-%d)"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
